{{/* Get the base link */}}
{{ $link := .Get "link" }}

{{/* Automatically append affiliate tag if affiliate="true" and link is not internal */}}
{{ if and (.Get "affiliate") (ne $link "#") (not (strings.HasPrefix $link "/")) }}
{{ $tag := site.Params.affiliate.amazon | default "savemybonsai-20" }}
{{ if strings.Contains $link "?" }}
{{ $link = (print $link "&tag=" $tag) }}
{{ else }}
{{ $link = (print $link "?tag=" $tag) }}
{{ end }}
{{ end }}

<div
  class="my-8 bg-white border border-stone-200 rounded-xl overflow-hidden shadow-sm hover:shadow-md transition-shadow duration-300 flex flex-col md:flex-row">
  <div class="md:w-1/3 bg-stone-50 flex items-center justify-center p-6">
    <img src="{{ .Get " image" }}" alt="{{ .Get " name" }}" loading="lazy"
      class="max-h-48 object-contain mix-blend-multiply">
  </div>
  <div class="p-6 md:w-2/3 flex flex-col justify-center">
    <div class="flex items-start justify-between mb-2">
      <h3 class="text-xl font-bold text-stone-900 leading-tight">{{ .Get "name" }}</h3>
      <div class="text-lg font-bold text-primary-600 whitespace-nowrap ml-4">{{ .Get "price" }}</div>
    </div>
    <div class="text-sm text-yellow-500 mb-3">{{ .Get "rating" }}</div>
    <p class="text-stone-600 text-sm mb-6 flex-grow">{{ .Get "description" }}</p>

    <div class="flex flex-col sm:flex-row gap-3 items-center">
      <a href="{{ $link }}"
        class="w-full sm:w-auto px-6 py-3 bg-yellow-500 hover:bg-yellow-400 text-stone-900 font-bold rounded-lg text-center transition-colors shadow-sm"
        target="_blank" rel="noopener noreferrer">
        {{ .Get "cta" | default "Check Price on Amazon" }}
      </a>
      {{ if and (.Get "affiliate") (ne (.Get "link") "#") }}
      <span class="text-xs text-stone-400">
        *We earn a commission at no extra cost to you.
      </span>
      {{ end }}
    </div>
  </div>
</div>