{{/* Get the base link */}}
{{ $link := .Get "link" }}

{{/* Automatically append affiliate tag if affiliate="true" and link is not internal */}}
{{ if and (.Get "affiliate") (ne $link "#") (not (strings.HasPrefix $link "/")) }}
  {{ if strings.Contains $link "?" }}
    {{ $link = (print $link "&tag=savemybonsai-20") }}
  {{ else }}
    {{ $link = (print $link "?tag=savemybonsai-20") }}
  {{ end }}
{{ end }}

<div class="product-recommendation">
  <a href="{{ $link }}" target="_blank" rel="noopener noreferrer">
    <img src="{{ .Get "image" }}" alt="{{ .Get "name" }}" loading="lazy">
    <h3>{{ .Get "name" }}</h3>
  </a>
  <p>{{ .Get "description" }}</p>
  <div class="flex items-center justify-between mb-4">
    <div class="text-2xl font-bold text-green-600 dark:text-green-400">{{ .Get "price" }}</div>
    <div class="text-sm text-gray-500 dark:text-gray-400">{{ .Get "rating" }}</div>
  </div>
  <a href="{{ $link }}" class="btn w-full text-center" target="_blank" rel="noopener noreferrer">
    {{ .Get "cta" | default "Buy Now" }}
  </a>
  {{ if and (.Get "affiliate") (ne (.Get "link") "#") }}
  <div class="text-xs text-gray-500 dark:text-gray-400 text-center mt-2">
    *Affiliate link - helps support our free content
  </div>
  {{ end }}
</div>
